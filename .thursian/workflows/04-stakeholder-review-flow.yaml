name: thursian-stakeholder-review-flow
description: >
  Stakeholder review and validation of the PRD before build. The Engineering Manager
  presents the PRD section by section to the original ideation team (Dreamer + Doer)
  and focus group participants. Each section gets 5 rounds of feedback to ensure
  alignment with the original vision and user needs.

version: 1.0.0

memory:
  backend: agentdb
  namespaces:
    prds: product-requirements
    ideation-personas: ideation-conversations
    focus-group-personas: focus-group-personas
    stakeholder-feedback: stakeholder-feedback
    approved-prds: approved-product-requirements

input:
  type: file
  path_template: .thursian/projects/{project-name}/03-{project-name}-prd.md
  format: markdown
  handoff_from: 03-engineering-meeting-flow.yaml

agents:

  - id: engineering_manager
    role: presenter_and_facilitator
    persona_file: .thursian/personas/stakeholder/engineering-manager.md
    tools: [memory.read, memory.write]
    config:
      style: professional_presenter
      focuses_on: [clarity, alignment, consensus_building, decision_facilitation]
      expertise: [technical_communication, stakeholder_management, requirements_validation]

  - id: dreamer
    role: original_visionary
    persona_file: .thursian/personas/ideation/dreamer.md
    tools: [memory.read, memory.write]
    config:
      restored_from: ideation_phase
      thinking_style: expansive
      validates: [vision_alignment, innovation_preserved, user_impact]

  - id: doer
    role: original_pragmatist
    persona_file: .thursian/personas/ideation/doer.md
    tools: [memory.read, memory.write]
    config:
      restored_from: ideation_phase
      thinking_style: grounded
      validates: [feasibility_maintained, scope_realistic, mvp_clarity]

  - id: focus_group_persona_1
    role: end_user_representative
    persona_template: dynamic
    tools: [memory.read, memory.write]
    config:
      restored_from: focus_group_phase
      represents: primary_user_segment
      validates: [needs_addressed, pain_points_solved, usability]

  - id: focus_group_persona_2
    role: end_user_representative
    persona_template: dynamic
    tools: [memory.read, memory.write]
    config:
      restored_from: focus_group_phase
      represents: secondary_user_segment
      validates: [needs_addressed, pain_points_solved, usability]

  - id: focus_group_persona_3
    role: end_user_representative
    persona_template: dynamic
    tools: [memory.read, memory.write]
    config:
      restored_from: focus_group_phase
      represents: tertiary_user_segment
      validates: [needs_addressed, pain_points_solved, usability]

  - id: focus_group_persona_4
    role: end_user_representative
    persona_template: dynamic
    tools: [memory.read, memory.write]
    config:
      restored_from: focus_group_phase
      represents: business_user_segment
      validates: [needs_addressed, pain_points_solved, usability]

  - id: focus_group_persona_5
    role: domain_expert_user
    persona_template: dynamic
    tools: [memory.read, memory.write]
    config:
      restored_from: focus_group_phase
      represents: expert_perspective
      validates: [domain_accuracy, best_practices, professional_viability]

  - id: feedback_synthesizer
    role: documentarian
    persona_file: .thursian/personas/ideation/synthesizer.md
    tools: [memory.read, filesystem.write]
    output_contract:
      - type: conversation_transcript
        format: markdown
        path_template: .thursian/projects/{project-name}/04-{project-name}-stakeholder-full.md
        description: "Complete stakeholder review discussion"
      - type: stakeholder_feedback
        format: markdown
        path_template: .thursian/projects/{project-name}/04-{project-name}-stakeholder-feedback.md
        description: "Stakeholder feedback and revision recommendations"
      - type: prd_approved
        format: markdown
        path_template: .thursian/projects/{project-name}/design-docs/PRD-approved.md
        description: "Approved PRD with critical changes incorporated"

# PRD sections to review (grouped for efficiency)
prd_sections:

  - id: section_1_vision_and_problem
    name: "Vision & Problem Statement"
    includes: [executive_summary, problem_statement]
    focus: "Does this capture the original vision? Is the problem clearly defined?"

  - id: section_2_users_and_requirements
    name: "Users & Functional Requirements"
    includes: [user_personas, functional_requirements]
    focus: "Are users accurately represented? Do requirements address their needs?"

  - id: section_3_technical_and_nfr
    name: "Technical & Non-Functional Requirements"
    includes: [non_functional_requirements, technical_considerations]
    focus: "Are technical constraints clear? Are quality attributes defined?"

  - id: section_4_success_metrics
    name: "Success Metrics & KPIs"
    includes: [success_metrics, launch_criteria]
    focus: "How will we measure success? Are targets realistic?"

  - id: section_5_competitive_analysis
    name: "Competitive Analysis & Positioning"
    includes: [competitive_analysis, market_positioning]
    focus: "Do we understand the competition? Is our differentiation clear?"

  - id: section_6_risks_and_scope
    name: "Risks & Out of Scope"
    includes: [risks_and_mitigations, out_of_scope]
    focus: "Are risks identified? Is scope clear and realistic?"

  - id: section_7_timeline_and_roadmap
    name: "Timeline & Roadmap"
    includes: [timeline_and_phases, key_milestones]
    focus: "Is the timeline achievable? Is the phasing logical?"

workflow:

  entry_state: initialize
  exit_states: [complete]

  states:

    initialize:
      agent: engineering_manager
      description: "Load PRD and restore all stakeholder personas from previous phases"
      actions:
        - type: filesystem.read
          path_from_input: prd_path
        - type: memory.read
          namespace: ideation-personas
          restore: [dreamer, doer]
        - type: memory.read
          namespace: focus-group-personas
          restore: [persona_1, persona_2, persona_3, persona_4, persona_5]
        - type: parse_prd
          extract_sections: [executive_summary, problem_statement, user_personas, functional_requirements, non_functional_requirements, success_metrics, competitive_analysis, technical_considerations, risks, out_of_scope, timeline]
        - type: memory.write
          namespace: prds
          key: current_prd
        - type: memory.write
          namespace: stakeholder-feedback
          key: session_initialized
        - type: prepare_presentation
      transitions:
        on_success: opening_introductions

    opening_introductions:
      description: "Engineering Manager introduces everyone and they share what excites them"
      parallel_agents: [engineering_manager, dreamer, doer, focus_group_persona_1, focus_group_persona_2, focus_group_persona_3, focus_group_persona_4, focus_group_persona_5]

      engineering_manager:
        actions:
          - type: introduce_session
            message: "Thank you all for joining this stakeholder review. We've taken the vision you created and the user feedback from our focus groups and translated that into a comprehensive Product Requirements Document. Before we start building, I want to make sure this PRD truly captures what we set out to create. Let me introduce everyone..."
          - type: introduce_participants
            list: [Dreamer, Doer, Focus Group Participants]
          - type: ask_for_excitement
            question: "Before we dive into the PRD, I'd love to hear from each of you: What excites you most about this idea?"
          - type: moderate_discussion
          - type: memory.write
            namespace: stakeholder-feedback
            key: opening_introductions

      dreamer:
        actions:
          - type: introduce_self
          - type: share_excitement
            focus: [original_vision, innovation, user_impact, possibilities]
            style: expansive_enthusiastic
          - type: memory.write
            namespace: stakeholder-feedback
            key: dreamer_excitement

      doer:
        actions:
          - type: introduce_self
          - type: share_excitement
            focus: [feasibility_realized, clear_path_forward, ready_to_build]
            style: pragmatic_confident
          - type: memory.write
            namespace: stakeholder-feedback
            key: doer_excitement

      focus_group_persona_1:
        actions:
          - type: introduce_self
          - type: share_excitement
            focus: [problems_being_solved, features_that_matter, willingness_to_use]
            style: user_authentic
          - type: memory.write
            namespace: stakeholder-feedback
            key: persona_1_excitement

      focus_group_persona_2:
        actions:
          - type: introduce_self
          - type: share_excitement
            build_on: [persona_1_response]
          - type: memory.write
            namespace: stakeholder-feedback
            key: persona_2_excitement

      focus_group_persona_3:
        actions:
          - type: introduce_self
          - type: share_excitement
            build_on: [previous_responses]
          - type: memory.write
            namespace: stakeholder-feedback
            key: persona_3_excitement

      focus_group_persona_4:
        actions:
          - type: introduce_self
          - type: share_excitement
            build_on: [previous_responses]
          - type: memory.write
            namespace: stakeholder-feedback
            key: persona_4_excitement

      focus_group_persona_5:
        actions:
          - type: introduce_self
          - type: share_excitement
            focus: [professional_validation, domain_fit, market_opportunity]
            build_on: [previous_responses]
          - type: memory.write
            namespace: stakeholder-feedback
            key: persona_5_excitement

      transitions:
        on_complete: section_1_round_1

    # SECTION 1: Vision & Problem Statement

    section_1_round_1:
      description: "Section 1, Round 1: Initial reactions to Vision & Problem Statement"
      agents: [engineering_manager, dreamer, doer, focus_group_persona_1, focus_group_persona_2, focus_group_persona_3, focus_group_persona_4, focus_group_persona_5]

      engineering_manager:
        actions:
          - type: present_section
            section: vision_and_problem
            include: [executive_summary, problem_statement]
          - type: ask_question
            question: "Let's start with the Executive Summary and Problem Statement. This is the heart of what we're building and why. What are your initial reactions?"
          - type: facilitate_discussion
            ensure: [all_voices_heard, authentic_feedback]
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_1

      dreamer:
        actions:
          - type: review_section
          - type: respond
            validates: [vision_captured, innovation_preserved, excitement_maintained]
            focus: [does_this_match_our_vision, is_the_why_clear]
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_1_dreamer

      doer:
        actions:
          - type: review_section
          - type: respond
            validates: [problem_clearly_stated, solution_grounded, feasibility_clear]
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_1_doer

      focus_group_persona_1:
        actions:
          - type: review_section
          - type: respond
            validates: [my_pain_points_captured, solution_addresses_needs]
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_1_persona_1

      focus_group_persona_2:
        actions:
          - type: review_section
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_1_persona_2

      focus_group_persona_3:
        actions:
          - type: review_section
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_1_persona_3

      focus_group_persona_4:
        actions:
          - type: review_section
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_1_persona_4

      focus_group_persona_5:
        actions:
          - type: review_section
          - type: respond
            validates: [domain_accuracy, market_understanding]
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_1_persona_5

      transitions:
        on_complete: section_1_round_2

    section_1_round_2:
      description: "Section 1, Round 2: Anything missing from Vision & Problem?"
      agents: [engineering_manager, dreamer, doer, focus_group_persona_1, focus_group_persona_2, focus_group_persona_3, focus_group_persona_4, focus_group_persona_5]

      engineering_manager:
        actions:
          - type: ask_question
            question: "Round 2: Is there anything you thought would be in this section that's missing? Any aspect of the vision or problem that wasn't captured?"
          - type: facilitate_discussion
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_2

      dreamer:
        actions:
          - type: identify_gaps
            focus: [vision_elements, innovation_aspects, user_impact_dimensions]
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_2_dreamer

      doer:
        actions:
          - type: identify_gaps
            focus: [problem_dimensions, solution_clarity, feasibility_aspects]
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_2_doer

      focus_group_persona_1:
        actions:
          - type: identify_gaps
            focus: [my_problems, additional_pain_points]
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_2_persona_1

      focus_group_persona_2:
        actions:
          - type: identify_gaps
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_2_persona_2

      focus_group_persona_3:
        actions:
          - type: identify_gaps
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_2_persona_3

      focus_group_persona_4:
        actions:
          - type: identify_gaps
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_2_persona_4

      focus_group_persona_5:
        actions:
          - type: identify_gaps
            focus: [domain_considerations, market_aspects]
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_2_persona_5

      transitions:
        on_complete: section_1_round_3

    section_1_round_3:
      description: "Section 1, Round 3: What would you like changed?"
      agents: [engineering_manager, dreamer, doer, focus_group_persona_1, focus_group_persona_2, focus_group_persona_3, focus_group_persona_4, focus_group_persona_5]

      engineering_manager:
        actions:
          - type: ask_question
            question: "Round 3: Is there anything in this section you would like to see changed? Any wording, framing, or emphasis that doesn't quite fit?"
          - type: facilitate_discussion
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_3

      dreamer:
        actions:
          - type: suggest_changes
            focus: [wording, emphasis, vision_clarity]
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_3_dreamer

      doer:
        actions:
          - type: suggest_changes
            focus: [clarity, feasibility_framing, solution_description]
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_3_doer

      focus_group_persona_1:
        actions:
          - type: suggest_changes
            focus: [user_language, problem_description]
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_3_persona_1

      focus_group_persona_2:
        actions:
          - type: suggest_changes
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_3_persona_2

      focus_group_persona_3:
        actions:
          - type: suggest_changes
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_3_persona_3

      focus_group_persona_4:
        actions:
          - type: suggest_changes
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_3_persona_4

      focus_group_persona_5:
        actions:
          - type: suggest_changes
            focus: [domain_terminology, market_framing]
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_3_persona_5

      transitions:
        on_complete: section_1_synthesis

    section_1_synthesis:
      agent: engineering_manager
      description: "Synthesize Section 1 feedback and prepare for prioritization"
      actions:
        - type: memory.read
          namespace: stakeholder-feedback
          scope: section_1_all_rounds
        - type: synthesize_feedback
          identify: [all_issues, suggestions, concerns]
        - type: group_feedback
          by: [theme, type, stakeholder]
        - type: memory.write
          namespace: stakeholder-feedback
          key: section_1_synthesis
      transitions:
        on_success: section_1_round_4

    section_1_round_4:
      description: "Section 1, Round 4: Prioritize critical issues"
      agents: [engineering_manager, dreamer, doer, focus_group_persona_1, focus_group_persona_2, focus_group_persona_3, focus_group_persona_4, focus_group_persona_5]

      engineering_manager:
        actions:
          - type: present_synthesized_feedback
            from: section_1_synthesis
          - type: ask_question
            question: "Round 4: Looking at all the feedback we've gathered, which issues do you think are CRITICAL to address before we move forward? What absolutely must be changed or added?"
          - type: facilitate_prioritization
            method: discussion_and_voting
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_4

      dreamer:
        actions:
          - type: prioritize_issues
            criteria: [vision_alignment, innovation_preservation]
            mark_as: critical
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_4_dreamer

      doer:
        actions:
          - type: prioritize_issues
            criteria: [clarity, feasibility, scope]
            mark_as: critical
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_4_doer

      focus_group_persona_1:
        actions:
          - type: prioritize_issues
            criteria: [user_needs, pain_points_accuracy]
            mark_as: critical
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_4_persona_1

      focus_group_persona_2:
        actions:
          - type: prioritize_issues
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_4_persona_2

      focus_group_persona_3:
        actions:
          - type: prioritize_issues
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_4_persona_3

      focus_group_persona_4:
        actions:
          - type: prioritize_issues
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_4_persona_4

      focus_group_persona_5:
        actions:
          - type: prioritize_issues
            criteria: [domain_accuracy, professional_viability]
            mark_as: critical
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_4_persona_5

      transitions:
        on_complete: section_1_round_5

    section_1_round_5:
      description: "Section 1, Round 5: Identify nice-to-haves"
      agents: [engineering_manager, dreamer, doer, focus_group_persona_1, focus_group_persona_2, focus_group_persona_3, focus_group_persona_4, focus_group_persona_5]

      engineering_manager:
        actions:
          - type: ask_question
            question: "Round 5: Of the remaining feedback, which issues are NICE-TO-HAVE? What would improve the section but isn't critical?"
          - type: facilitate_prioritization
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_5

      dreamer:
        actions:
          - type: prioritize_issues
            exclude: already_marked_critical
            mark_as: nice_to_have
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_5_dreamer

      doer:
        actions:
          - type: prioritize_issues
            mark_as: nice_to_have
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_5_doer

      focus_group_persona_1:
        actions:
          - type: prioritize_issues
            mark_as: nice_to_have
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_5_persona_1

      focus_group_persona_2:
        actions:
          - type: prioritize_issues
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_5_persona_2

      focus_group_persona_3:
        actions:
          - type: prioritize_issues
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_5_persona_3

      focus_group_persona_4:
        actions:
          - type: prioritize_issues
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_5_persona_4

      focus_group_persona_5:
        actions:
          - type: prioritize_issues
          - type: respond
          - type: memory.write
            namespace: stakeholder-feedback
            key: section_1_round_5_persona_5

      transitions:
        on_complete: section_2_round_1

    # SECTION 2: Users & Functional Requirements
    # (Repeat same 5-round structure for each section)
    # For brevity in YAML, I'll use template notation

    section_2_round_1:
      template: section_review_round
      section: users_and_requirements
      round: 1
      question: "What are your initial reactions to how we've captured user personas and functional requirements?"
      transitions:
        on_complete: section_2_round_2

    section_2_round_2:
      template: section_review_round
      section: users_and_requirements
      round: 2
      question: "Is there anything missing? User segments not represented? Requirements not captured?"
      transitions:
        on_complete: section_2_round_3

    section_2_round_3:
      template: section_review_round
      section: users_and_requirements
      round: 3
      question: "What would you like changed? Personas more accurate? Requirements clearer?"
      transitions:
        on_complete: section_2_synthesis

    section_2_synthesis:
      template: synthesis
      section: users_and_requirements
      transitions:
        on_success: section_2_round_4

    section_2_round_4:
      template: prioritization_round
      section: users_and_requirements
      round: 4
      question: "Which issues are CRITICAL to address?"
      transitions:
        on_complete: section_2_round_5

    section_2_round_5:
      template: prioritization_round
      section: users_and_requirements
      round: 5
      question: "Which issues are NICE-TO-HAVE?"
      transitions:
        on_complete: section_3_round_1

    # SECTION 3: Technical & Non-Functional Requirements

    section_3_round_1:
      template: section_review_round
      section: technical_and_nfr
      round: 1
      question: "Initial reactions to technical considerations and non-functional requirements?"
      transitions:
        on_complete: section_3_round_2

    section_3_round_2:
      template: section_review_round
      section: technical_and_nfr
      round: 2
      question: "Anything missing? Performance targets? Security requirements?"
      transitions:
        on_complete: section_3_round_3

    section_3_round_3:
      template: section_review_round
      section: technical_and_nfr
      round: 3
      question: "What would you like changed?"
      transitions:
        on_complete: section_3_synthesis

    section_3_synthesis:
      template: synthesis
      section: technical_and_nfr
      transitions:
        on_success: section_3_round_4

    section_3_round_4:
      template: prioritization_round
      section: technical_and_nfr
      round: 4
      question: "Which technical issues are CRITICAL?"
      transitions:
        on_complete: section_3_round_5

    section_3_round_5:
      template: prioritization_round
      section: technical_and_nfr
      round: 5
      question: "Which are NICE-TO-HAVE?"
      transitions:
        on_complete: section_4_round_1

    # SECTION 4: Success Metrics

    section_4_round_1:
      template: section_review_round
      section: success_metrics
      round: 1
      question: "Initial reactions to success metrics and KPIs?"
      transitions:
        on_complete: section_4_round_2

    section_4_round_2:
      template: section_review_round
      section: success_metrics
      round: 2
      question: "Missing metrics? Important KPIs not captured?"
      transitions:
        on_complete: section_4_round_3

    section_4_round_3:
      template: section_review_round
      section: success_metrics
      round: 3
      question: "What would you like changed? Targets unrealistic?"
      transitions:
        on_complete: section_4_synthesis

    section_4_synthesis:
      template: synthesis
      section: success_metrics
      transitions:
        on_success: section_4_round_4

    section_4_round_4:
      template: prioritization_round
      section: success_metrics
      round: 4
      question: "Which metric issues are CRITICAL?"
      transitions:
        on_complete: section_4_round_5

    section_4_round_5:
      template: prioritization_round
      section: success_metrics
      round: 5
      question: "Which are NICE-TO-HAVE?"
      transitions:
        on_complete: section_5_round_1

    # SECTION 5: Competitive Analysis

    section_5_round_1:
      template: section_review_round
      section: competitive_analysis
      round: 1
      question: "Initial reactions to competitive analysis and positioning?"
      transitions:
        on_complete: section_5_round_2

    section_5_round_2:
      template: section_review_round
      section: competitive_analysis
      round: 2
      question: "Missing competitors? Positioning not clear?"
      transitions:
        on_complete: section_5_round_3

    section_5_round_3:
      template: section_review_round
      section: competitive_analysis
      round: 3
      question: "What would you like changed?"
      transitions:
        on_complete: section_5_synthesis

    section_5_synthesis:
      template: synthesis
      section: competitive_analysis
      transitions:
        on_success: section_5_round_4

    section_5_round_4:
      template: prioritization_round
      section: competitive_analysis
      round: 4
      question: "Which competitive issues are CRITICAL?"
      transitions:
        on_complete: section_5_round_5

    section_5_round_5:
      template: prioritization_round
      section: competitive_analysis
      round: 5
      question: "Which are NICE-TO-HAVE?"
      transitions:
        on_complete: section_6_round_1

    # SECTION 6: Risks & Out of Scope

    section_6_round_1:
      template: section_review_round
      section: risks_and_scope
      round: 1
      question: "Initial reactions to risks and scope boundaries?"
      transitions:
        on_complete: section_6_round_2

    section_6_round_2:
      template: section_review_round
      section: risks_and_scope
      round: 2
      question: "Missing risks? Scope unclear?"
      transitions:
        on_complete: section_6_round_3

    section_6_round_3:
      template: section_review_round
      section: risks_and_scope
      round: 3
      question: "What would you like changed?"
      transitions:
        on_complete: section_6_synthesis

    section_6_synthesis:
      template: synthesis
      section: risks_and_scope
      transitions:
        on_success: section_6_round_4

    section_6_round_4:
      template: prioritization_round
      section: risks_and_scope
      round: 4
      question: "Which risk/scope issues are CRITICAL?"
      transitions:
        on_complete: section_6_round_5

    section_6_round_5:
      template: prioritization_round
      section: risks_and_scope
      round: 5
      question: "Which are NICE-TO-HAVE?"
      transitions:
        on_complete: section_7_round_1

    # SECTION 7: Timeline & Roadmap

    section_7_round_1:
      template: section_review_round
      section: timeline_and_roadmap
      round: 1
      question: "Initial reactions to timeline and roadmap?"
      transitions:
        on_complete: section_7_round_2

    section_7_round_2:
      template: section_review_round
      section: timeline_and_roadmap
      round: 2
      question: "Missing milestones? Phasing unclear?"
      transitions:
        on_complete: section_7_round_3

    section_7_round_3:
      template: section_review_round
      section: timeline_and_roadmap
      round: 3
      question: "What would you like changed?"
      transitions:
        on_complete: section_7_synthesis

    section_7_synthesis:
      template: synthesis
      section: timeline_and_roadmap
      transitions:
        on_success: section_7_round_4

    section_7_round_4:
      template: prioritization_round
      section: timeline_and_roadmap
      round: 4
      question: "Which timeline issues are CRITICAL?"
      transitions:
        on_complete: section_7_round_5

    section_7_round_5:
      template: prioritization_round
      section: timeline_and_roadmap
      round: 5
      question: "Which are NICE-TO-HAVE?"
      transitions:
        on_complete: synthesize_all_feedback

    synthesize_all_feedback:
      agent: feedback_synthesizer
      description: "Create conversation transcript and stakeholder feedback report"
      actions:
        - type: memory.read
          namespace: stakeholder-feedback
          scope: all_sections_all_rounds
        - type: export_conversation
          format: full_transcript
          include: [all_sections, all_rounds, stakeholder_names, timestamps]
        - type: filesystem.write
          path_template: .thursian/projects/{project-name}/04-{project-name}-stakeholder-full.md
        - type: synthesize
          format: stakeholder_feedback_report
          sections:
            - executive_summary:
                - overall_sentiment
                - approval_status
                - key_themes
            - critical_issues_by_section:
                - section_name
                - issue_description
                - stakeholder_concerns
                - recommended_change
                - consensus_level
            - nice_to_have_by_section:
                - section_name
                - suggestion_description
                - stakeholder_support
                - recommended_change
            - stakeholder_quotes:
                - dreamer_highlights
                - doer_highlights
                - user_highlights
            - annotated_prd:
                - original_prd_with_inline_comments
                - color_coded_feedback
                - suggested_changes_tracked
            - next_steps:
                - prd_revision_required
                - critical_changes_must_address
                - nice_to_have_changes_optional
                - approval_decision
        - type: filesystem.write
          path_template: .thursian/projects/{project-name}/04-{project-name}-stakeholder-feedback.md
        - type: memory.write
          namespace: stakeholder-feedback
          key: final_synthesis
      transitions:
        on_success: final_decision

    final_decision:
      agent: engineering_manager
      description: "Engineering Manager summarizes and asks for final approval"
      actions:
        - type: present_synthesis
          from: stakeholder_feedback_report
        - type: summarize
          highlight: [critical_issues, nice_to_haves, overall_sentiment]
        - type: ask_for_decision
          options:
            - approve_as_is
            - approve_with_critical_changes
            - revise_and_review_again
        - type: facilitate_consensus
        - type: memory.write
          namespace: stakeholder-feedback
          key: final_decision
      transitions:
        on_approve: prd_approved
        on_revise: prd_revision_needed

    prd_approved:
      agent: engineering_manager
      description: "PRD approved, ready for technical design"
      actions:
        - type: declare
          message: "Excellent! We have stakeholder approval. The PRD captures our vision, addresses user needs, and has clear technical direction. Let's move forward to detailed technical design and then build this!"
        - type: create_approved_prd
          incorporate: [critical_changes]
          note: [nice_to_have_changes_for_future]
        - type: filesystem.write
          path_template: .thursian/projects/{project-name}/design-docs/PRD-approved.md
        - type: memory.write
          namespace: approved-prds
          key_from: idea_id
        - type: create_handoff
          next_phase: technical_design
          artifacts: [approved_prd, stakeholder_feedback]
      transitions:
        on_success: complete

    prd_revision_needed:
      agent: engineering_manager
      description: "PRD needs revision before approval"
      actions:
        - type: declare
          message: "We have valuable feedback that requires PRD revision. I'll work with the product team to address the critical issues and we'll reconvene for another review."
        - type: create_revision_plan
          address: [all_critical_issues]
          consider: [high_priority_nice_to_haves]
        - type: memory.write
          namespace: stakeholder-feedback
          key: revision_plan
        - type: create_handoff
          next_phase: prd_revision
          artifacts: [stakeholder_feedback, revision_plan]
      transitions:
        on_success: complete

    complete:
      description: "Stakeholder review complete"
      final: true
      handoff:
        next_workflow: 05-technical-design-flow.yaml  # (if approved)
        artifacts:
          - approved_prd OR stakeholder_feedback_report
        status: approved OR needs_revision
        context:
          stakeholder_validated: true
          ready_for_build: true OR false
